<div id="container">
  <!-- picked entries -->
  <div id="picked" class="form-row">
    <!-- count -->
    <span class="nr" [class.error]="entries().length < minEntries()">{{
      entries().length
    }}</span>
    @if (maxEntries() > 1) {
    <span class="muted">/{{ maxEntries() }}</span>
    <span class="muted">: -{{ remaining() }}</span>
    } @if (minEntries() > 0) {
    <span class="muted"> (min {{ minEntries() }})</span>
    }
    <!-- list -->
    @for (e of entries(); track e.id) {
    <span
      matRipple
      matRippleColor="red"
      class="entry"
      [class.error]="!allowCustom() && e.id.startsWith('$')"
      (click)="removeEntry(e)"
      >{{ renderLabel(e.value) }}</span
    >
    } @empty {
    <span class="muted">{{ emptyMessage() }}</span>
    }
    <!-- clear -->
    @if (entries().length > 0) {
    <button
      type="button"
      mat-icon-button
      matTooltip="Remove all entries"
      (click)="clear()"
      [disabled]="entries().length === 0"
    >
      <mat-icon class="mat-warn">clear</mat-icon>
    </button>
    }
    <!-- toggler -->
    <button
      type="button"
      mat-icon-button
      matTooltip="Toggle picker"
      (click)="expanded.set(!expanded())"
    >
      @if (expanded()) {
      <mat-icon class="mat-primary">publish</mat-icon>
      } @if (!expanded()) {
      <mat-icon class="mat-primary">get_app</mat-icon>
      }
    </button>
  </div>

  <!-- entries picker -->
  <div id="picker">
    <mat-expansion-panel
      [expanded]="expanded()"
      (expandedChange)="expanded.set($event)"
    >
      <div>
        <fieldset>
          <legend>available</legend>
          <cadmus-thesaurus-tree
            [entries]="availableEntries()"
            [renderLabel]="renderLabel"
            (entryChange)="onEntryChange($event)"
          />
        </fieldset>
      </div>
      @if (allowCustom()) {
      <div>
        <form>
          <fieldset>
            <legend>custom</legend>
            <div class="form-row">
              <mat-form-field>
                <input
                  matInput
                  type="text"
                  [formControl]="id"
                  placeholder="ID"
                />
              </mat-form-field>
              <mat-form-field>
                <input
                  matInput
                  type="text"
                  [formControl]="value"
                  placeholder="label"
                />
              </mat-form-field>
              <button
                type="button"
                mat-icon-button
                matTooltip="Add custom entry"
                (click)="addCustomEntry()"
                [disabled]="!form.valid || entries().length >= maxEntries()"
              >
                <mat-icon class="mat-primary">add</mat-icon>
              </button>
            </div>
          </fieldset>
        </form>
      </div>
      }
    </mat-expansion-panel>
  </div>
</div>
